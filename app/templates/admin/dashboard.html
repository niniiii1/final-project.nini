{% extends 'base.html' %}

{% block title %}Admin Dashboard | Rock Music Hub{% endblock %}

{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3">Admin Dashboard</h1>
      <p class="text-muted">Manage content, users, and community moderation.</p>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="h5 mb-0">Bands</h2>
            <a class="btn btn-sm btn-primary" href="{{ url_for('admin.create_band') }}">Add Band</a>
          </div>
          <ul class="list-group list-group-flush">
            {% for band in bands %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ band.name }}</span>
              <div class="d-flex gap-2">
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin.edit_band', band_id=band.id) }}">Edit</a>
                <form method="post" action="{{ url_for('admin.delete_band', band_id=band.id) }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                </form>
              </div>
            </li>
            {% else %}
            <li class="list-group-item text-muted">No bands yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="h5 mb-0">Albums</h2>
            <a class="btn btn-sm btn-primary" href="{{ url_for('admin.create_album') }}">Add Album</a>
          </div>
          <ul class="list-group list-group-flush">
            {% for album in albums %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ album.title }}</span>
              <div class="d-flex gap-2">
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin.edit_album', album_id=album.id) }}">Edit</a>
                <form method="post" action="{{ url_for('admin.delete_album', album_id=album.id) }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                </form>
              </div>
            </li>
            {% else %}
            <li class="list-group-item text-muted">No albums yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="h5 mb-0">Events</h2>
            <a class="btn btn-sm btn-primary" href="{{ url_for('admin.create_event') }}">Add Event</a>
          </div>
          <ul class="list-group list-group-flush">
            {% for event in events %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ event.title }}</span>
              <div class="d-flex gap-2">
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin.edit_event', event_id=event.id) }}">Edit</a>
                <form method="post" action="{{ url_for('admin.delete_event', event_id=event.id) }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                </form>
              </div>
            </li>
            {% else %}
            <li class="list-group-item text-muted">No events yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h5">Community Comments</h2>
          <ul class="list-group list-group-flush">
            {% for comment in comments %}
            <li class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <span class="small text-muted">{{ comment.user.username }} on {{ comment.target_type }} #{{ comment.target_id }}</span>
                <form method="post" action="{{ url_for('admin.toggle_comment', comment_id=comment.id) }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button class="btn btn-sm btn-outline-warning" type="submit">
                    {% if comment.is_hidden %}Unhide{% else %}Hide{% endif %}
                  </button>
                </form>
              </div>
              <p class="mb-0">{{ comment.body }}</p>
            </li>
            {% else %}
            <li class="list-group-item text-muted">No comments yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h5">Users</h2>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Admin</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                <tr>
                  <td>{{ user.username }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ 'Yes' if user.is_admin else 'No' }}</td>
                  <td>
                    <form method="post" action="{{ url_for('admin.toggle_admin', user_id=user.id) }}">
                      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                      <button class="btn btn-sm btn-outline-primary" type="submit">Toggle admin</button>
                    </form>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="4" class="text-muted">No users found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
